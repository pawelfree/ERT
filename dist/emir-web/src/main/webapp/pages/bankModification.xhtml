
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition   template="/templates/main.xhtml"
                  xmlns="http://www.w3.org/1999/xhtml"
                  xmlns:h="http://java.sun.com/jsf/html"
                  xmlns:f="http://java.sun.com/jsf/core"
                  xmlns:ui="http://java.sun.com/jsf/facelets"
                  xmlns:p="http://primefaces.org/ui"
                  xmlns:emir="http://java.sun.com/jsf/composite/facelets"
                  xmlns:emirui="http://pl.pd/emir">

    <ui:define name="pageTitle">
        <h:form id="title">
            <h:outputText value="#{msgs['bankModification.bankData.header.details']}" rendered="#{not bankBean.editMode}"/>
            <h:outputText value="#{msgs['bankModification.bankData.header.edit']}" rendered="#{bankBean.editMode}"/>
        </h:form>
    </ui:define>
    <ui:define name="body">

        <h:form id="dataForm">
            <h:panelGroup id="dataPanel">
                <p:panel id="buttonsPanel" styleClass="buttonsPanel">
                    <p:commandButton value="#{msgs['button.modify']}" 
                                     action="#{bankBean.setEditMode(true)}" 
                                     update="@form" 
                                     process="@form" 
                                     ajax="false"
                                     rendered="#{not bankBean.editMode}" />
                    <p:commandButton type="submit" 
                                     ajax="true" 
                                     action="#{bankBean.saveStep1()}"
                                     update="dataPanel"
                                     value="#{msgs['button.save']}"         
                                     rendered="#{bankBean.editMode}" />
                    <p:commandButton value="#{msgs['button.cancel']}" 
                                     action="#{bankBean.getAction()}"
                                     ajax="false"
                                     immediate="true"
                                     rendered="#{bankBean.editMode}" />
                    <p:commandButton value="#{msgs['button.history']}" 
                                     action="#{bankHistoryBean.init()}" 
                                     process="@form" 
                                     rendered="#{not bankBean.editMode}" />
                    <p:commandButton value="#{msgs['bankModification.button.generate']}"
                                     title="#{msgs['bankModification.button.title']}"
                                     oncomplete="PF('kdpwConfirmDialog').show();"
                                     rendered="#{bankBean.getEnabledGenerate()}"
                                     disabled="#{bankBean.sendToKdpwDisabled}" 
                                     ajax="true"/>
                </p:panel>
                <ui:remove><!--Status zmian danych instytucji--></ui:remove>
                <p:panel id="panelStatus" rendered="#{not bankBean.editMode}">
                    <emirui:labeledOutput id="bankStatus" value="#{msgs[bankBean.bank.bankStatus.msgKey]}" label="#{msgs['bankModification.bankStatus']} " />      
                </p:panel>
                <p:panel id="panelData" header="#{msgs['bankModification.bankData.header']}" toggleable="true" toggleSpeed="100" closable="false">
                    <p:messages autoUpdate="true" showSummary="false" showDetail="true" severity="info"/>
                    <p:messages autoUpdate="true" showSummary="false" showDetail="true" severity="warn"/>
                    <ui:remove><!--Dane instytucji--></ui:remove>          
                    <p:panelGrid columns="2">
                        <ui:remove><!--Nazwa (String bankName)--></ui:remove>
                        <emirui:labeledOutput id="bankNameOutput" value="#{bankBean.bank.bankName}" label="#{msgs['bankModification.bankName']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="bankNameInput" 
                                         maxlength="100" 
                                         value="#{bankBean.bank.bankName}" 
                                         label="#{msgs['bankModification.bankName']}" 
                                         info="#{msgs['bankModification.bankName']}" 
                                         rendered="#{bankBean.editMode}" />

                        <ui:remove><!--Nr rozliczeniowy (String bankNr)--></ui:remove>
                        <emirui:labeledOutput id="bankNrOutput" value="#{bankBean.bank.bankNr}" label="#{msgs['bankModification.bankNr']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="bankNrInput"  
                                         value="#{bankBean.bank.bankNr}" 
                                         label="#{msgs['bankModification.bankNr']}" 
                                         info="#{msgs['bankModification.bankNr']}" 
                                         maxlength="8" 
                                         rendered="#{bankBean.editMode}" />

                        <ui:remove><!--Nazwa w komunikacie (String xmlBankName)--></ui:remove>
                        <emirui:labeledOutput id="xmlBankNameOutput" value="#{bankBean.bank.xmlBankName}" label="#{msgs['bankModification.xmlBankName']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="xmlBankNameInput" 
                                         required="false"
                                         value="#{bankBean.bank.xmlBankName}" 
                                         label="#{msgs['bankModification.xmlBankName']}" 
                                         info="#{msgs['bankModification.xmlBankName']}" 
                                         rendered="#{bankBean.editMode}" >
                        </emirui:inputText>


                        <ui:remove><!--Identyfikator ESMA (String senderId)--></ui:remove>
                        <emirui:labeledOutput id="senderIdOutput" value="#{bankBean.bank.senderId}" label="#{msgs['bankModification.senderId']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="senderIdInput" 
                                         value="#{bankBean.bank.senderId}" 
                                         label="#{msgs['bankModification.senderId']}" 
                                         info="#{msgs['bankModification.senderId']}"  
                                         minlength="4" 
                                         maxlength="4" 
                                         rendered="#{bankBean.editMode}" />

                        <ui:remove><!--Identyfikator KDPW_TR (String senderIdKdpw)--></ui:remove>
                        <emirui:labeledOutput id="senderIdKdpwOutput" value="#{bankBean.bank.senderIdKdpw}" label="#{msgs['bankModification.senderIdKdpw']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="senderIdKdpwInput" 
                                         required="true" 
                                         value="#{bankBean.bank.senderIdKdpw}" 
                                         label="#{msgs['bankModification.senderIdKdpw']}" 
                                         info="#{msgs['bankModification.senderIdKdpw']}" 
                                         minlength="4"  
                                         maxlength="4" 
                                         rendered="#{bankBean.editMode}" />

                        <ui:remove><!--Data zmiany wyceny (String institution.institutionData.institutionId)--></ui:remove>
                        <emirui:labeledOutput id="valuationReportingDateOutput" value="#{bankBean.bank.valuationReportingDate}" label="#{msgs['bankModification.valuationReportingDate']}" rendered="#{not bankBean.editMode}">
                            <f:convertDateTime pattern="#{applicationBean.dateFormat}"/>
                        </emirui:labeledOutput>
                        <emirui:inputDate id="valuationReportingDateInput" 
                                         value="#{bankBean.bank.valuationReportingDate}" 
                                         pattern="#{applicationBean.dateFormat}" 
                                         label="#{msgs['bankModification.valuationReportingDate']}" 
                                         info="#{msgs['bankModification.valuationReportingDate']}" 
                                         required="true" 
                                         rendered="#{bankBean.editMode}" />
                    </p:panelGrid>
                    <p:panel header="#{msgs['register.sets.groupValuationForm.sectionId']}" toggleable="true" toggleSpeed="100">
                        <p:panelGrid columns="2">
                            <ui:remove><!--Identyfikator (String institution.institutionData.institutionId)--></ui:remove>
                            <emirui:labeledOutput id="institutionIdOutput" 
                                                 value="#{bankBean.bank.institution.institutionData.institutionId}"
                                                 label="#{msgs['bankModification.institution.institutionId']}" 
                                                 rendered="#{not bankBean.editMode}" />
                            <emirui:inputText id="institutionIdInput"  
                                             value="#{bankBean.bank.institution.institutionData.institutionId}" 
                                             label="#{msgs['bankModification.institution.institutionId']}" 
                                             info="#{msgs['bankModification.institution.institutionId']}" 
                                             maxlength="50" 
                                             required="true" 
                                             rendered="#{bankBean.editMode}" >
                                <p:ajax event="change" update="institutionIdTypeInput"/>
                            </emirui:inputText>

                            <ui:remove><!--Typ identyfikatora (Enum InstitutionIdType institution.institutionData.institutionIdType)--></ui:remove>
                            <emirui:labeledOutput id="institutionIdTypeOutput" value="#{bankBean.bank.institution.institutionData.institutionIdType.name()}" label="#{msgs['bankModification.institution.institutionIdType']}" rendered="#{not bankBean.editMode}" />
                            <emirui:inputSelect id="institutionIdTypeInput" 
                                               value="#{bankBean.bank.institution.institutionData.institutionIdType}" 
                                               label="#{msgs['bankModification.institution.institutionIdType']}" 
                                               info="#{msgs['bankModification.institution.institutionIdType']}" 
                                               rendered="#{bankBean.editMode}"
                                               required="true">
                                <f:selectItems value="#{bankBean.institutionIdTypes}" var="option" itemLabel="#{option}" itemValue="#{option}"/>
                            </emirui:inputSelect>

                        </p:panelGrid>
                    </p:panel>
                    <p:panel header="#{msgs['bankModification.section.internalId']}" toggleable="true" toggleSpeed="100">
                        <p:panelGrid columns="2">
                            <ui:remove><!--NIP (String businessEntity.subjectNip)--></ui:remove>
                            <emirui:labeledOutput id="subjectNipOutput" value="#{bankBean.bank.businessEntity.subjectNip}" label="#{msgs['bankModification.subjectNip']}" rendered="#{not bankBean.editMode}" />
                            <emirui:inputText id="subjectNipInput" value="#{bankBean.bank.businessEntity.subjectNip}" label="#{msgs['bankModification.subjectNip']}" info="#{msgs['bankModification.subjectNip']}" maxlength="18" rendered="#{bankBean.editMode}" >
                                <f:validator validatorId="pl.pd.emir.clientutils.validators.NipValidator"/>
                            </emirui:inputText>

                            <ui:remove><!--REGON (String businessEntity.subjectRegon)--></ui:remove>
                            <emirui:labeledOutput id="subjectRegonOutput" value="#{bankBean.bank.businessEntity.subjectRegon}" label="#{msgs['bankModification.subjectRegon']}" rendered="#{not bankBean.editMode}" />
                            <emirui:inputText id="subjectRegonInput" value="#{bankBean.bank.businessEntity.subjectRegon}" label="#{msgs['bankModification.subjectRegon']}" info="#{msgs['bankModification.subjectRegon']}" maxlength="18" rendered="#{bankBean.editMode}" >
                                <f:validator validatorId="pl.pd.emir.clientutils.validators.RegonValidator"/>
                            </emirui:inputText>

                            <ui:remove><!--Branża (String contrPartyIndustry)--></ui:remove>
                            <emirui:labeledOutput id="contrPartyIndustryOutput" value="#{bankBean.bank.contrPartyIndustry}" label="#{msgs['bankModification.contrPartyIndustry']}" rendered="#{not bankBean.editMode}" />
                            <emirui:inputSelect id="contrPartyIndustryInput" 
                                               label="#{msgs['bankModification.contrPartyIndustry']}"  
                                               info="#{msgs['bankModification.contrPartyIndustry']}"
                                               value="#{bankBean.bank.contrPartyIndustry}"
                                               rendered="#{bankBean.editMode}">
                                <f:selectItem itemLabel="#{msgs['commons.select']}" itemValue="#{null}" itemDisabled="false" />
                                <f:selectItems value="#{clientFormBean.contrPartyIndustries}" itemValue="#{option.name()}" var="option" itemLabel="#{msgs[option.msgKey]}" />
                            </emirui:inputSelect>

                            <ui:remove><!--Kontrahent (String contrPartyType)--></ui:remove>
                            <emirui:labeledOutput id="contrPartyTypeOutput" value="#{bankBean.bank.contrPartyType}" label="#{msgs['bankModification.contrPartyType']}" rendered="#{not bankBean.editMode}" />
                            <emirui:inputSelect id="contrPartyTypeInput" 
                                               value="#{bankBean.bank.contrPartyType}" 
                                               label="#{msgs['bankModification.contrPartyType']}" 
                                               info="#{msgs['bankModification.contrPartyType']}" 
                                               rendered="#{bankBean.editMode}" 
                                               required="true"
                                               allowEmpty="true">
                                <f:selectItem itemLabel="F" itemValue="F"/>
                                <f:selectItem itemLabel="N" itemValue="N"/>
                            </emirui:inputSelect>
                        </p:panelGrid>
                    </p:panel>
                </p:panel>

                <p:panel header="#{msgs['bankModification.institutionData.header']}" toggleable="true" toggleSpeed="100" collapsed="true">
                    <ui:remove><!--Dane adresowe--></ui:remove>
                    <p:panelGrid columns="2">
                        <ui:remove><!--Kod kraju (Enum CountryCode countryCode)--></ui:remove>
                        <emirui:labeledOutput id="countryCodeOutput" value="#{bankBean.bank.countryCode}" label="#{msgs['bankModification.countryCode']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputSelect id="countryCodeInput" value="#{bankBean.bank.countryCode}" label="#{msgs['bankModification.countryCode']}" 
                                           required="true"
                                           info="#{msgs['bankModification.countryCode']}" 
                                           rendered="#{bankBean.editMode}"
                                           allowEmpty="true">
                            <f:selectItems value="#{bankBean.countryCodes}" var="code" itemLabel="#{code.name()}" itemValue="#{code}"/>
                        </emirui:inputSelect>

                        <ui:remove><!--Kod pocztowy (String institution.institutionAddr.postalCode)--></ui:remove>
                        <emirui:labeledOutput id="postalCodeOutput" value="#{bankBean.bank.institution.institutionAddr.postalCode}" label="#{msgs['bankModification.institution.postalCode']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="postalCodeInput" value="#{bankBean.bank.institution.institutionAddr.postalCode}" label="#{msgs['bankModification.institution.postalCode']}" info="#{msgs['bankModification.institution.postalCode']}" maxlength="40" rendered="#{bankBean.editMode}" />

                        <ui:remove><!--Miasto (String institution.institutionAddr.city)--></ui:remove>
                        <emirui:labeledOutput id="cityOutput" value="#{bankBean.bank.institution.institutionAddr.city}" label="#{msgs['bankModification.institution.city']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="cityInput" 
                                         required="false"
                                         value="#{bankBean.bank.institution.institutionAddr.city}" 
                                         label="#{msgs['bankModification.institution.city']}" 
                                         info="#{msgs['bankModification.institution.city']}" 
                                         maxlength="60" 
                                         rendered="#{bankBean.editMode}" >
                        </emirui:inputText>

                        <ui:remove><!--Ulica (String institution.institutionAddr.streetName)--></ui:remove>
                        <emirui:labeledOutput id="streetNameOutput" value="#{bankBean.bank.institution.institutionAddr.streetName}" label="#{msgs['bankModification.institution.streetName']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="streetNameInput" value="#{bankBean.bank.institution.institutionAddr.streetName}" label="#{msgs['bankModification.institution.streetName']}" info="#{msgs['bankModification.institution.streetName']}" maxlength="150" rendered="#{bankBean.editMode}" />

                        <ui:remove><!--Nr budynku (Integer institution.institutionAddr.buildingId)--></ui:remove>
                        <emirui:labeledOutput id="buildingIdOutput" value="#{bankBean.bank.institution.institutionAddr.buildingId}" label="#{msgs['bankModification.institution.buildingId']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="buildingIdInput" 
                                         value="#{bankBean.bank.institution.institutionAddr.buildingId}" 
                                         label="#{msgs['bankModification.institution.buildingId']}" 
                                         info="#{msgs['bankModification.institution.buildingId']}" 
                                         maxlength="20"
                                         rendered="#{bankBean.editMode}" >
                        </emirui:inputText>

                        <ui:remove><!--Nr lokalu (Integer institution.institutionAddr.premisesId)--></ui:remove>
                        <emirui:labeledOutput id="premisesIdOutput" value="#{bankBean.bank.institution.institutionAddr.premisesId}" label="#{msgs['bankModification.institution.premisesId']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="premisesIdInput" 
                                         value="#{bankBean.bank.institution.institutionAddr.premisesId}" 
                                         label="#{msgs['bankModification.institution.premisesId']}" 
                                         info="#{msgs['bankModification.institution.premisesId']}" 
                                         maxlength="20"
                                         rendered="#{bankBean.editMode}">
                        </emirui:inputText>

                        <ui:remove><!--Inne (String institution.institutionAddr.details)--></ui:remove>
                        <emirui:labeledOutput id="detailsOutput" value="#{bankBean.bank.institution.institutionAddr.details}" label="#{msgs['bankModification.institution.details']}" rendered="#{not bankBean.editMode}" />
                        <emirui:inputText id="detailsInput" value="#{bankBean.bank.institution.institutionAddr.details}" label="#{msgs['bankModification.institution.details']}" info="#{msgs['bankModification.institution.details']}" maxlength="208" rendered="#{bankBean.editMode}" />
                    </p:panelGrid>
                </p:panel>

            </h:panelGroup>
        </h:form>
        <h:form>
            <p:confirmDialog id="confirmDialog" widgetVar="confirmDialog" message="#{msgs['bankModification.dialog.confirm.message']}" header="#{msgs['button.save']}">
                <p:commandButton value="#{msgs['button.yes']}" oncomplete="PF('confirmDialog').hide();"  type="submit"  immediate="false" ajax="false"  action="#{bankBean.saveStep2(false)}" />  
                <p:commandButton value="#{msgs['button.no']}" onclick="PF('confirmDialog').hide();" immediate="true"/>
            </p:confirmDialog>
        </h:form>

        <h:form id="kdpwConfirmForm">
            <emir:messageDialog dialogId="kdpwConfirmDialog" 
                                message="#{msgs['bankModification.kdpw.message.confirm']}" 
                                dialogType="CONFIRM" 
                                closeButtonLabel="#{msgs['button.no']}" >
                <p:commandButton value="#{msgs['button.yes']}" 
                                 process="@this" 
                                 actionListener="#{bankBean.generateMessage()}"
                                 oncomplete="PF('kdpwConfirmDialog').hide(); PF('kdpwResultDialog').show();" 
                                 update=":kdpwResultForm :dataForm:buttonsPanel"
                                 />
            </emir:messageDialog>
        </h:form>

        <h:form id="kdpwResultForm">
            <emir:messageDialog dialogId="kdpwResultDialog" 
                                message="#{bankBean.sendingResult}" 
                                dialogType="#{bankBean.sendingResultType}"
                                update=":dataForm:panelStatus"
                                >
            </emir:messageDialog>
        </h:form>
    </ui:define>
</ui:composition>
